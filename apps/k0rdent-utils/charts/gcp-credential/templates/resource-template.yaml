apiVersion: v1
kind: ConfigMap
metadata:
  name: gcp-cloud-sa-resource-template
  labels:
    k0rdent.mirantis.com/component: "kcm"
  annotations:
    projectsveltos.io/template: "true"
data:
  configmap.yaml: |
    {{`{{- $secret := (getResource "InfrastructureProviderIdentity") -}}`}}
    {{`{{- if not $secret -}}`}}
      {{`{{- fail "Error: InfrastructureProviderIdentitySecret not found" -}}`}}
    {{`{{- end -}}`}}
    ---
    apiVersion: v1
    kind: Secret
    metadata:
      name: gcp-cloud-sa
      namespace: kube-system
    type: Opaque
    data:
      cloud-sa.json: {{`{{ index $secret "data" "credentials" }}`}}
